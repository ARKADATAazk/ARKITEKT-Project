RegionPlaylist/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ state.lua              # Unified state manager
â”‚   â”œâ”€â”€ config.lua             # UI constants, dimensions, colors
â”‚   â”œâ”€â”€ controller.lua         # Playlist operations with undo
â”‚   â”œâ”€â”€ shortcuts.lua          # Keyboard handlers
â”‚   â”œâ”€â”€ dependency_graph.lua   # Circular reference detection
â”‚   â””â”€â”€ keys.lua               # Centralized key generation
â”œâ”€â”€ playback/
â”‚   â”œâ”€â”€ coordinator.lua        # Bridge between app and engine
â”‚   â”œâ”€â”€ engine.lua             # Core playback logic
â”‚   â”œâ”€â”€ transport.lua          # Reaper transport wrapper
â”‚   â”œâ”€â”€ transitions.lua        # Region-to-region transitions
â”‚   â”œâ”€â”€ scheduler.lua          # Quantize with trigger regions
â”‚   â””â”€â”€ tracker.lua            # Progress monitoring
â”œâ”€â”€ playlists/
â”‚   â”œâ”€â”€ manager.lua            # CRUD operations
â”‚   â”œâ”€â”€ sequencer.lua          # Cache and sequence lookups
â”‚   â””â”€â”€ expander.lua           # Recursive playlist expansion
â”œâ”€â”€ regions/
â”‚   â”œâ”€â”€ registry.lua           # Region cache, change detection
â”‚   â””â”€â”€ pool.lua               # Pool filtering and sorting
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ main.lua               # Window orchestration, layout
â”‚   â”œâ”€â”€ transport_bar.lua      # Controls, quantize selector
â”‚   â”œâ”€â”€ active_panel.lua       # Active playlist with tabs
â”‚   â”œâ”€â”€ pool_panel.lua         # Region/playlist pool
â”‚   â””â”€â”€ status_bar.lua         # Status display
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ tiles/
â”‚   â”‚   â”œâ”€â”€ base.lua           # Shared rendering logic
â”‚   â”‚   â”œâ”€â”€ active.lua         # Active playlist tiles
â”‚   â”‚   â”œâ”€â”€ pool.lua           # Pool tiles
â”‚   â”‚   â””â”€â”€ config.lua         # Tile constants
â”‚   â”œâ”€â”€ controls/
â”‚   â”‚   â””â”€â”€ quantize.lua       # Quantize dropdown
â”‚   â””â”€â”€ selector.lua           # Playlist tab chips
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ persistence.lua        # ExtState save/load
â”‚   â”œâ”€â”€ settings.lua           # User preferences
â”‚   â”œâ”€â”€ migration.lua          # Data format upgrades
â”‚   â””â”€â”€ undo.lua               # History management
â””â”€â”€ ARK_RegionPlaylist.lua     # Entry point

Total: ~35 files (down from 116)
```

Key changes in `arkitekt/` library:
```
arkitekt/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ events.lua             # Generic event bus (NEW)
â”œâ”€â”€ patterns/
â”‚   â”œâ”€â”€ controller.lua         # Base controller pattern (NEW)
â”‚   â””â”€â”€ coordinator.lua        # UI-backend bridge pattern (NEW)
â””â”€â”€ gui/widgets/grid/
    â””â”€â”€ bridge.lua             # Grid drag coordination (MOVED)


RegionPlaylist/
â”œâ”€â”€ domains/
â”‚   â”œâ”€â”€ playback/
â”‚   â”‚   â”œâ”€â”€ engine.lua
â”‚   â”‚   â”œâ”€â”€ transport.lua
â”‚   â”‚   â”œâ”€â”€ transitions.lua
â”‚   â”‚   â”œâ”€â”€ quantize_hack.lua
â”‚   â”‚   â””â”€â”€ progress_tracker.lua
â”‚   â”œâ”€â”€ playlist/
â”‚   â”‚   â”œâ”€â”€ manager.lua
â”‚   â”‚   â”œâ”€â”€ sequencer.lua
â”‚   â”‚   â”œâ”€â”€ expander.lua
â”‚   â”‚   â”œâ”€â”€ operations.lua
â”‚   â”‚   â””â”€â”€ circular_check.lua
â”‚   â””â”€â”€ regions/
â”‚       â”œâ”€â”€ scanner.lua
â”‚       â”œâ”€â”€ cache.lua
â”‚       â””â”€â”€ pool_manager.lua
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ windows/
â”‚   â”‚   â”œâ”€â”€ main_window.lua
â”‚   â”‚   â”œâ”€â”€ transport_bar.lua
â”‚   â”‚   â””â”€â”€ layout_manager.lua
â”‚   â”œâ”€â”€ grids/
â”‚   â”‚   â”œâ”€â”€ active_playlist.lua
â”‚   â”‚   â”œâ”€â”€ region_pool.lua
â”‚   â”‚   â””â”€â”€ grid_bridge.lua
â”‚   â”œâ”€â”€ tiles/
â”‚   â”‚   â”œâ”€â”€ active_renderer.lua
â”‚   â”‚   â”œâ”€â”€ pool_renderer.lua
â”‚   â”‚   â””â”€â”€ tile_base.lua
â”‚   â””â”€â”€ overlays/
â”‚       â””â”€â”€ playlist_selector.lua
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ store.lua          # Single source of truth
â”‚   â”œâ”€â”€ persistence.lua
â”‚   â””â”€â”€ history.lua
â””â”€â”€ main.lua
```

## Option 2: Clean Architecture Layers
```
RegionPlaylist/
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ main_view.lua
â”‚   â”‚   â”œâ”€â”€ transport_view.lua
â”‚   â”‚   â”œâ”€â”€ active_list_view.lua
â”‚   â”‚   â””â”€â”€ pool_view.lua
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ tile.lua
â”‚   â”‚   â”œâ”€â”€ grid.lua
â”‚   â”‚   â”œâ”€â”€ separator.lua
â”‚   â”‚   â””â”€â”€ header.lua
â”‚   â””â”€â”€ themes/
â”‚       â””â”€â”€ default.lua
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ playlist_controller.lua
â”‚   â”‚   â”œâ”€â”€ playback_controller.lua
â”‚   â”‚   â””â”€â”€ ui_controller.lua
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ sequence_service.lua
â”‚   â”‚   â”œâ”€â”€ region_service.lua
â”‚   â”‚   â””â”€â”€ sync_service.lua
â”‚   â””â”€â”€ commands/         # Command pattern for operations
â”‚       â”œâ”€â”€ add_item.lua
â”‚       â”œâ”€â”€ reorder.lua
â”‚       â””â”€â”€ delete_item.lua
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ playlist.lua
â”‚   â”‚   â”œâ”€â”€ region.lua
â”‚   â”‚   â””â”€â”€ playback_state.lua
â”‚   â””â”€â”€ use_cases/
â”‚       â”œâ”€â”€ expand_playlist.lua
â”‚       â””â”€â”€ calculate_sequence.lua
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ reaper/
â”‚   â”‚   â”œâ”€â”€ regions_api.lua
â”‚   â”‚   â””â”€â”€ transport_api.lua
â”‚   â””â”€â”€ storage/
â”‚       â””â”€â”€ ext_state.lua
â””â”€â”€ bootstrap.lua
```

## Option 3: Feature-Based Modules
```
RegionPlaylist/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ state_manager.lua
â”‚   â”œâ”€â”€ event_bus.lua
â”‚   â””â”€â”€ config.lua
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ playback/
â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”œâ”€â”€ engine.lua
â”‚   â”‚   â”œâ”€â”€ controls.lua
â”‚   â”‚   â””â”€â”€ quantize.lua
â”‚   â”œâ”€â”€ playlist_editor/
â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”œâ”€â”€ list_view.lua
â”‚   â”‚   â”œâ”€â”€ item_operations.lua
â”‚   â”‚   â””â”€â”€ drag_drop.lua
â”‚   â”œâ”€â”€ region_pool/
â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”œâ”€â”€ pool_view.lua
â”‚   â”‚   â”œâ”€â”€ filters.lua
â”‚   â”‚   â””â”€â”€ sorting.lua
â”‚   â”œâ”€â”€ transport/
â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”œâ”€â”€ controls.lua
â”‚   â”‚   â””â”€â”€ display.lua
â”‚   â””â”€â”€ history/
â”‚       â”œâ”€â”€ index.lua
â”‚       â””â”€â”€ undo_redo.lua
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ grid.lua
â”‚   â”‚   â””â”€â”€ tile.lua
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ colors.lua
â”‚       â””â”€â”€ timing.lua
â””â”€â”€ app.lua
```

## Option 4: Component-Centric Architecture
```
RegionPlaylist/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ containers/
â”‚   â”‚   â”œâ”€â”€ MainWindow/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.lua
â”‚   â”‚   â”‚   â””â”€â”€ state.lua
â”‚   â”‚   â”œâ”€â”€ TransportBar/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”‚   â”œâ”€â”€ buttons.lua
â”‚   â”‚   â”‚   â””â”€â”€ quantize_selector.lua
â”‚   â”‚   â””â”€â”€ SplitView/
â”‚   â”‚       â”œâ”€â”€ index.lua
â”‚   â”‚       â””â”€â”€ separator.lua
â”‚   â”œâ”€â”€ lists/
â”‚   â”‚   â”œâ”€â”€ ActivePlaylist/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.lua
â”‚   â”‚   â”‚   â”œâ”€â”€ grid.lua
â”‚   â”‚   â”‚   â”œâ”€â”€ items.lua
â”‚   â”‚   â”‚   â””â”€â”€ interactions.lua
â”‚   â”‚   â””â”€â”€ RegionPool/
â”‚   â”‚       â”œâ”€â”€ index.lua
â”‚   â”‚       â”œâ”€â”€ grid.lua
â”‚   â”‚       â””â”€â”€ filters.lua
â”‚   â””â”€â”€ primitives/
â”‚       â”œâ”€â”€ Tile/
â”‚       â”‚   â”œâ”€â”€ index.lua
â”‚       â”‚   â”œâ”€â”€ variants.lua
â”‚       â”‚   â””â”€â”€ animations.lua
â”‚       â””â”€â”€ DragGhost/
â”‚           â””â”€â”€ index.lua
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ playback_engine.lua
â”‚   â”œâ”€â”€ playlist_manager.lua
â”‚   â”œâ”€â”€ region_scanner.lua
â”‚   â””â”€â”€ state_coordinator.lua
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ playlist.lua
â”‚   â”œâ”€â”€ region.lua
â”‚   â””â”€â”€ app_state.lua
â””â”€â”€ init.lua
```

## Comparison Table

| Approach | Pros | Cons |
|----------|------|------|
| **Domain-Driven** | Clear business logic separation, easy to find related code | May duplicate some UI components |
| **Clean Architecture** | Strict separation of concerns, testable | More boilerplate, steeper learning curve |
| **Feature-Based** | Self-contained features, easy to add/remove features | Potential for cross-feature dependencies |
| **Component-Centric** | Mirrors UI structure, React-like patterns | Business logic scattered across components |

## My Recommendation

**Option 1 (Domain-Driven)** with these refinements:
```
RegionPlaylist/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ state.lua           # Unified state manager
â”‚   â”œâ”€â”€ events.lua          # Event bus
â”‚   â””â”€â”€ config.lua
â”œâ”€â”€ playback/
â”‚   â”œâ”€â”€ engine.lua
â”‚   â”œâ”€â”€ transport.lua
â”‚   â”œâ”€â”€ scheduler.lua       # Instead of "quantize_hack"
â”‚   â””â”€â”€ tracker.lua
â”œâ”€â”€ playlists/
â”‚   â”œâ”€â”€ manager.lua
â”‚   â”œâ”€â”€ sequencer.lua
â”‚   â””â”€â”€ expander.lua
â”œâ”€â”€ regions/
â”‚   â”œâ”€â”€ registry.lua        # Instead of "cache"
â”‚   â””â”€â”€ pool.lua
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ main.lua
â”‚   â”œâ”€â”€ transport_bar.lua
â”‚   â”œâ”€â”€ active_panel.lua
â”‚   â””â”€â”€ pool_panel.lua
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ grids/
â”‚   â”œâ”€â”€ tiles/
â”‚   â””â”€â”€ controls/
â”œâ”€â”€ storage/
â”‚   â””â”€â”€ persistence.lua
â””â”€â”€ main.lua


Config vs Constants - When to Use Each?
Use config.lua when:

âœ… Values that define how features work
âœ… Complex nested structures
âœ… Factory functions that generate configs
âœ… Things you might want to make user-configurable later
âœ… Values that differ per environment/feature

Examples:
luaconfig.quantize_grid_options = { ... }  -- List of options
config.get_container_config(...)        -- Generated configs
config.separator_defaults = { ... }     -- Feature behavior
Use constants.lua when:

âœ… True mathematical/physical constants
âœ… Magic numbers with no business logic
âœ… Enum-like values
âœ… Values that never change
âœ… Simple primitive values

Examples:
luaconstants.HOVER_SPEED = 12.0           -- Animation speed
constants.MAX_UNDO_STACK = 50          -- Hard limit
constants.EPSILON = 0.001              -- Float comparison
constants.STATUS = { OK = 1, ERROR = 2 }  -- Enum
Use theme.lua when:

âœ… All visual design tokens
âœ… Colors, fonts, spacing scales
âœ… Things a designer would tweak
âœ… Visual consistency across app

Examples:
luatheme.colors.primary = 0x42E896FF
theme.spacing.base = 8
theme.fonts.default = "Arial"

ðŸŽ¨ Industry Standards (What Others Use)
Framework/ToolVisualStructuralConstantsReact/Webtheme.jsconfig.jsconstants.jsUnityTheme.csGameConfig.csConstants.csUnrealStyle.hConfig.iniConstants.hAndroidstyles.xml / colors.xmlconfig.xmlConstants.java
Common pattern: Split visual from structural.




























Structure Summary
Folder Categories
ARK_FeatureName/
â”œâ”€â”€ domain/          # Business logic, no UI code
â”œâ”€â”€ ui/              # Views and components, presentation only
â”œâ”€â”€ state/           # Store, persistence (ExtState save/load)
â”œâ”€â”€ network/         # WAAPI, HTTP, WebSocket (only if needed)
â”œâ”€â”€ config.lua       # Feature behavior, factory functions
â”œâ”€â”€ constants.lua    # Immutable values, enums, limits
â”œâ”€â”€ theme.lua        # Colors, spacing, fonts (optional)
â””â”€â”€ ARK_FeatureName.lua  # Entry point
```

### Rules

**Folder Creation:**
- Start minimal, add folders when â‰¥3 related files
- Max 3 levels deep
- Cache lives in `domain/{feature}/cache.lua`
- File I/O stays in `domain/` unless 3+ import/export modules

**File Naming:**
- `{feature}_manager.lua` - Orchestrates domain logic
- `{feature}_view.lua` - Renders UI
- `{feature}_store.lua` - State slice
- `{feature}_bridge.lua` - Thin REAPER API wrapper (if 80%+ API calls)

**Import Rules:**
- `domain/` can import: `arkitekt/core`, `arkitekt/reaper`, other `domain/`, `state/` (read-only)
- `domain/` cannot import: `ui/`
- `ui/` can import: `domain/` (read-only), `state/`, `arkitekt/gui`
- `ui/` cannot import: direct REAPER API calls

**Generic helpers:** Put in `arkitekt/core/`, not in scripts

---

## RegionPlaylist Simulation
```
ARK_RegionPlaylist/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ playback/
â”‚   â”‚   â”œâ”€â”€ engine.lua              # Playback state machine
â”‚   â”‚   â”œâ”€â”€ scheduler.lua           # Quantization + triggers
â”‚   â”‚   â”œâ”€â”€ transitions.lua         # Region-to-region logic
â”‚   â”‚   â”œâ”€â”€ tracker.lua             # Progress monitoring
â”‚   â”‚   â””â”€â”€ reaper_bridge.lua       # Transport wrapper
â”‚   â”œâ”€â”€ playlists/
â”‚   â”‚   â”œâ”€â”€ manager.lua             # CRUD operations
â”‚   â”‚   â”œâ”€â”€ sequencer.lua           # Expansion logic
â”‚   â”‚   â””â”€â”€ validator.lua           # Circular reference check
â”‚   â”œâ”€â”€ regions/
â”‚   â”‚   â”œâ”€â”€ scanner.lua             # Polls REAPER regions
â”‚   â”‚   â”œâ”€â”€ registry.lua            # Cache + change detection
â”‚   â”‚   â””â”€â”€ pool_filter.lua         # Filtering/sorting
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ playlist.lua
â”‚       â”œâ”€â”€ region.lua
â”‚       â””â”€â”€ sequence.lua
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ main_view.lua           # Window orchestration
â”‚   â”‚   â”œâ”€â”€ transport_bar_view.lua  # Controls + quantize
â”‚   â”‚   â”œâ”€â”€ active_panel_view.lua   # Active playlist tabs
â”‚   â”‚   â””â”€â”€ pool_panel_view.lua     # Region pool
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ region_tile.lua         # Tile renderer
â”‚   â”‚   â”œâ”€â”€ playlist_chip.lua       # Tab selector
â”‚   â”‚   â””â”€â”€ separator.lua           # Split view divider
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ quantize_dropdown.lua
â”‚       â””â”€â”€ status_display.lua
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ store.lua                   # Single state tree
â”‚   â”œâ”€â”€ actions.lua                 # Action creators
â”‚   â”œâ”€â”€ persistence.lua             # ExtState save/load
â”‚   â””â”€â”€ migrations.lua              # Data format upgrades
â”œâ”€â”€ config.lua                      # Grid sizes, defaults, options
â”œâ”€â”€ constants.lua                   # Max undo, animation speeds
â”œâ”€â”€ theme.lua                       # Custom colors (if any)
â””â”€â”€ ARK_RegionPlaylist.lua          # Entry point